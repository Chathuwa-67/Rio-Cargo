<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Tiendas - Rio Cargo Express</title>
    <!-- Bootstrap 4 -->
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    />
    <!-- FontAwesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="https://courier.riocargoexpress.com/assets/images/logo-rio2.png"
    />
    <style>
      body {
        background: #00205d;
        font-family: Arial, sans-serif;
      }

      /* Navbar Styles */
      .navbar-container {
        display: flex;
        align-items: center;
        padding: 10px 0 10px 15px;
        position: relative;
        flex-wrap: wrap;
      }

      .navbar-custom {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: #0034c5;
        border-radius: 25px 0 0 25px;
        padding: 10px 20px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
        flex: 1;
        margin-left: 10px;
      }

      .logo img {
        height: 100px;
        margin-right: 15px;
      }

      .navbar-nav-custom {
        display: flex;
        list-style: none;
        margin: 0;
        padding: 0;
        flex-wrap: wrap;
      }

      .navbar-nav-custom li {
        margin: 0 18px;
        position: relative;
      }

      .navbar-nav-custom li a {
        text-decoration: none;
        color: #fff;
        font-weight: 500;
        transition: color 0.3s;
        font-size: 15px;
      }

      .navbar-nav-custom li a:hover {
        color: #ffd700;
      }

      .nav-icons {
        display: flex;
        align-items: center;
        gap: 20px;
      }

      .nav-icons a {
        color: white;
        font-size: 18px;
        margin-left: 15px;
        text-decoration: none;
      }

      .nav-icons a:hover {
        color: #ffd700;
      }

      .navbar-nav-custom li ul.dropdown-menu-custom {
        display: none;
        position: absolute;
        top: 100%;
        left: 0;
        background: #0034c5;
        border-radius: 10px;
        padding: 8px 0;
        list-style: none;
        min-width: 200px;
        z-index: 1000;
      }

      .navbar-nav-custom li ul.dropdown-menu-custom li {
        margin: 0;
      }

      .navbar-nav-custom li ul.dropdown-menu-custom li a {
        display: block;
        padding: 8px 15px;
        color: #fff;
        font-size: 14px;
        white-space: nowrap;
      }

      .navbar-nav-custom li ul.dropdown-menu-custom li a:hover {
        background: #002a99;
        color: #ffd700;
      }

      /* Show dropdown on hover */
      .navbar-nav-custom li:hover > ul.dropdown-menu-custom {
        display: block;
      }

      .profile-icon {
        background: #007bff;
        border-radius: 50%;
        padding: 6px;
      }

      .nav-icons img {
        width: 30px;
      }

      /* Form Card */
      .card-custom {
        background-color: #0034c5;
        border-radius: 25px;
        padding: 25px;
        color: white;
        box-shadow: 0 6px 18px rgba(0, 0, 0, 0.4);
        margin-bottom: 20px;
        font-weight: 600;
      }

      /* Dropdown cards */
      .dropdown-card {
        position: absolute;
        top: 70px;
        right: 20px;
        background: #ffffff;
        color: #000;
        width: 280px;
        border-radius: 12px;
        box-shadow: 0 6px 18px rgba(0, 0, 0, 0.3);
        padding: 15px;
        display: none;
        z-index: 10;
        animation: fadeInUp 0.3s ease;
      }

      .dropdown-card h6 {
        font-weight: bold;
        margin-bottom: 5px;
      }

      .dropdown-card hr {
        margin: 8px 0;
      }

      .dropdown-card a {
        display: block;
        color: #0034c5;
        font-weight: 500;
        padding: 5px 0;
        text-decoration: none;
      }

      .dropdown-card a:hover {
        color: #ff9900;
      }

      /* Animation */
      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(15px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Custom alert style */
      .custom-alert {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 9999;
        min-width: 300px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        border: none;
        border-left: 4px solid #28a745;
        opacity: 0;
        transform: translateX(100%);
        transition: opacity 0.5s, transform 0.5s;
      }

      .custom-alert.show {
        opacity: 1;
        transform: translateX(0);
      }

      .alert-success {
        background-color: #d4edda;
        color: #155724;
      }

      /* Store Directory specific styles */
      .filter-section {
        background: #0034c5;
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 20px;
      }

      .filter-row {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        margin-bottom: 15px;
      }

      .filter-item {
        flex: 1;
        min-width: 200px;
      }

      .filter-item label {
        color: white;
        font-weight: 600;
        margin-bottom: 5px;
        display: block;
      }

      .table-container {
        background: white;
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      }

      .pagination-info {
        color: #666;
        margin-bottom: 10px;
      }

      .pagination-custom .page-link {
        color: #0034c5;
        border: 1px solid #0034c5;
      }

      .pagination-custom .page-item.active .page-link {
        background: #0034c5;
        border-color: #0034c5;
      }

      .entries-select {
        width: 80px;
        display: inline-block;
        margin: 0 10px;
      }

      /* Form controls styling */
      .form-control-custom {
        background: #002a99;
        border: 1px solid #0048ff;
        border-radius: 8px;
        color: white;
        padding: 8px 12px;
      }

      .form-control-custom::placeholder {
        color: #a0c0ff;
      }

      .form-control-custom:focus {
        background: #002a99;
        border-color: #ffd700;
        color: white;
        box-shadow: 0 0 0 0.2rem rgba(255, 215, 0, 0.25);
      }

      /* Filter controls row */
      .filter-controls-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        flex-wrap: wrap;
        gap: 15px;
      }

      .search-box {
        flex: 1;
        min-width: 250px;
        max-width: 400px;
      }

      .filter-buttons {
        display: flex;
        gap: 10px;
      }

      /* Store Cards */
      .store-cards-container {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 20px;
        margin-top: 20px;
      }

      .store-card {
        background: white;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s, box-shadow 0.3s;
        height: 100%;
        display: flex;
        flex-direction: column;
      }

      .store-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
      }

      .store-image {
        width: 100%;
        height: 180px;
        object-fit: cover;
      }

      .store-content {
        padding: 15px;
        flex-grow: 1;
        display: flex;
        flex-direction: column;
      }

      .store-name {
        font-weight: bold;
        font-size: 18px;
        margin-bottom: 10px;
        color: #0034c5;
      }

      .store-category {
        display: inline-block;
        background-color: #e6f0ff;
        color: #0034c5;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 12px;
        margin-bottom: 15px;
      }

      .store-button {
        margin-top: auto;
        background-color: #0034c5;
        color: white;
        border: none;
        border-radius: 6px;
        padding: 8px 15px;
        font-weight: 500;
        transition: background-color 0.3s;
        cursor: pointer;
        text-align: center;
        text-decoration: none;
        display: block;
      }

      .store-button:hover {
        background-color: #002a99;
        color: white;
        text-decoration: none;
      }

      /* Modern Checkbox Styling */
      .category-filters {
        margin-top: 15px;
      }

      .category-filters h6 {
        color: white;
        margin-bottom: 10px;
        font-weight: 600;
      }

      .checkbox-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 10px;
      }

      .checkbox-item {
        display: flex;
        align-items: center;
        margin-bottom: 8px;
      }

      .checkbox-item input[type="checkbox"] {
        display: none;
      }

      .checkbox-item label {
        display: flex;
        align-items: center;
        cursor: pointer;
        color: white;
        font-weight: normal;
        margin-bottom: 0;
        padding: 8px 12px;
        border-radius: 20px;
        background: rgba(255, 255, 255, 0.1);
        transition: all 0.3s;
        width: 100%;
      }

      .checkbox-item label:hover {
        background: rgba(255, 255, 255, 0.2);
      }

      .checkbox-item input[type="checkbox"]:checked + label {
        background: rgba(255, 215, 0, 0.3);
        color: #ffd700;
        font-weight: 600;
      }

      .checkbox-item label:before {
        content: "";
        display: inline-block;
        width: 18px;
        height: 18px;
        border: 2px solid #fff;
        border-radius: 4px;
        margin-right: 10px;
        transition: all 0.3s;
      }

      .checkbox-item input[type="checkbox"]:checked + label:before {
        background-color: #ffd700;
        border-color: #ffd700;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%2300205d' stroke-width='3' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='20 6 9 17 4 12'%3E%3C/polyline%3E%3C/svg%3E");
        background-size: 12px;
        background-repeat: no-repeat;
        background-position: center;
      }

      /* Modal Styles */
      .modal-header-custom {
        background: #0034c5;
        color: white;
        border-bottom: none;
        border-radius: 10px 10px 0 0;
      }

      .modal-content-custom {
        border-radius: 10px;
        border: none;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      }

      .modal-footer-custom {
        border-top: 1px solid #e9ecef;
        padding: 15px;
      }

      .store-detail-row {
        margin-bottom: 15px;
        padding-bottom: 15px;
        border-bottom: 1px solid #eee;
      }

      .store-detail-label {
        font-weight: bold;
        color: #0034c5;
        margin-bottom: 5px;
      }

      .store-detail-value {
        color: #333;
      }

      .store-detail-url {
        color: #0034c5;
        text-decoration: none;
      }

      .store-detail-url:hover {
        text-decoration: underline;
      }

      /* Loading State */
      .loading-container {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 200px;
        flex-direction: column;
      }

      .spinner {
        border: 4px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top: 4px solid #0034c5;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin-bottom: 15px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      /* Casillero Table Styles */
      .casillero-table-container {
        margin: 20px 0;
        background: white;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      .casillero-table {
        width: 100%;
        border-collapse: collapse;
      }

      .casillero-table th {
        background: #0034c5;
        color: white;
        padding: 15px 10px;
        text-align: center;
        font-weight: 600;
        font-size: 14px;
        border-right: 1px solid #002a99;
      }

      .casillero-table th:last-child {
        border-right: none;
      }

      .casillero-table td {
        padding: 12px 10px;
        border-bottom: 1px solid #f0f0f0;
        vertical-align: top;
      }

      /* Dynamic column width based on number of columns */
      .casillero-table th:nth-child(1):nth-last-child(1),
      .casillero-table td:nth-child(1):nth-last-child(1) {
        width: 100%;
      }

      .casillero-table th:nth-child(1):nth-last-child(2),
      .casillero-table td:nth-child(1):nth-last-child(2),
      .casillero-table th:nth-child(2):nth-last-child(1),
      .casillero-table td:nth-child(2):nth-last-child(1) {
        width: 50%;
      }

      .casillero-table th:nth-child(1):nth-last-child(3),
      .casillero-table td:nth-child(1):nth-last-child(3),
      .casillero-table th:nth-child(2):nth-last-child(2),
      .casillero-table td:nth-child(2):nth-last-child(2),
      .casillero-table th:nth-child(3):nth-last-child(1),
      .casillero-table td:nth-child(3):nth-last-child(1) {
        width: 33.33%;
      }

      .casillero-country-section {
        text-align: center;
        padding: 15px;
      }

      .casillero-country-flag {
        font-size: 24px;
        margin-bottom: 8px;
      }

      .casillero-country-name {
        font-weight: 600;
        color: #0034c5;
        font-size: 14px;
      }

      .casillero-detail-item {
        margin-bottom: 12px;
        padding: 10px;
        background: #f8f9fa;
        border-radius: 8px;
        border-left: 3px solid #0034c5;
      }

      .casillero-detail-label {
        font-weight: bold;
        color: #0034c5;
        font-size: 12px;
        margin-bottom: 4px;
        display: block;
      }

      .casillero-detail-value {
        color: #333;
        font-size: 13px;
        word-break: break-word;
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 10px;
      }

      .casillero-detail-text {
        flex: 1;
      }

      .casillero-copy-btn {
        background-color: #ffcc00;
        border: none;
        color: #333;
        width: 24px;
        height: 24px;
        border-radius: 4px;
        cursor: pointer;
        display: flex;
        justify-content: center;
        align-items: center;
        flex-shrink: 0;
        transition: background-color 0.3s;
      }

      .casillero-copy-btn:hover {
        background-color: #e6b800;
      }

      .casillero-copy-btn i {
        font-size: 12px;
        color: #333;
      }

      /* Modal scrollable content */
      .modal-body {
        max-height: 60vh;
        overflow-y: auto;
        padding: 20px;
      }

      /* Responsive adjustments */
      @media (max-width: 992px) {
        .navbar-custom {
          flex-wrap: wrap;
          border-radius: 20px;
          padding: 10px;
        }
        .navbar-nav-custom {
          flex-direction: column;
          align-items: flex-start;
          width: 100%;
          margin-top: 10px;
        }
        .nav-icons {
          margin-top: 10px;
          width: 100%;
          justify-content: flex-start;
        }
        .filter-item {
          min-width: 150px;
        }
        .filter-controls-row {
          flex-direction: column;
          align-items: stretch;
        }
        .search-box {
          max-width: 100%;
        }
        .filter-buttons {
          justify-content: flex-end;
        }
        .checkbox-grid {
          grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
        }
      }

      @media (max-width: 768px) {
        .logo img {
          height: 50px;
        }
        .navbar-nav-custom li {
          margin: 6px 0;
        }
        .nav-icons a {
          font-size: 16px;
          margin-left: 10px;
        }
        .custom-alert {
          left: 20px;
          right: 20px;
          min-width: auto;
        }
        .modal-dialog {
          margin: 10px;
        }
        .store-cards-container {
          grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        }
        .checkbox-grid {
          grid-template-columns: 1fr;
        }
        .casillero-table-container {
          overflow-x: auto;
        }
        .casillero-table {
          min-width: 800px;
        }
        .casillero-table th,
        .casillero-table td {
          padding: 10px 8px;
        }
        .casillero-detail-item {
          padding: 8px;
        }
        .modal-body {
          max-height: 50vh;
        }
      }

      @media (max-width: 576px) {
        .navbar-container {
          flex-direction: column;
          padding: 10px;
        }
        .navbar-custom {
          margin-left: 0;
          border-radius: 20px;
        }
        .filter-item {
          min-width: 100%;
        }
        .filter-buttons {
          flex-direction: column;
        }
        .store-cards-container {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <!-- Custom Alert Container -->
    <div
      id="alertContainer"
      class="custom-alert alert alert-success"
      role="alert"
      style="display: none"
    >
      <div class="d-flex align-items-center">
        <i class="fas fa-check-circle mr-2"></i>
        <span id="alertMessage"></span>
      </div>
    </div>

    <!-- Navbar -->
    <header class="navbar-container">
      <div class="logo">
        <img src="./src/img/logo.png" alt="Rio Cargo Express Logo" />
      </div>
      <nav class="navbar-custom">
        <ul class="navbar-nav-custom">
          <!-- Tablero with dropdown -->
          <li class="dropdown">
            <a href="#">Tablero <i class="fas fa-caret-down"></i></a>
            <ul class="dropdown-menu-custom">
              <li><a href="#">Registrar paquete</a></li>
              <li><a href="#">Estado de paquetes</a></li>
              <li><a href="#">Asociados</a></li>
              <li><a href="#">Cupos</a></li>
            </ul>
          </li>

          <!-- Liquidación with dropdown -->
          <li class="dropdown">
            <a href="#">Liquidación <i class="fas fa-caret-down"></i></a>
            <ul class="dropdown-menu-custom">
              <li><a href="#">Casilleros</a></li>
              <li><a href="#">Tutoriales</a></li>
              <li><a href="#">Tiendas</a></li>
              <li><a href="#">Cotizador</a></li>
            </ul>
          </li>

          <!-- Programas de Recompensa (normal) -->
          <li class="dropdown">
            <a href="#">Guías y Casilleros <i class="fas fa-caret-down"></i></a>
            <ul class="dropdown-menu-custom">
              <li><a href="#">Liquidaciones Pendientes</a></li>
              <li><a href="#">Liquidaciones Canceladas</a></li>
              <li><a href="#">Cuentas Bancarias</a></li>
            </ul>
          </li>

          <!-- Historial de Tracking (normal) -->
          <li><a href="#">Wishlist</a></li>
        </ul>

        <!-- Nav icons -->
        <div class="nav-icons">
          <a href="javascript:void(0)" id="alertBtn"
            ><i class="fas fa-exclamation"></i
          ></a>
          <a href="javascript:void(0)" id="bellBtn"
            ><i class="fas fa-bell"></i
          ></a>
          <a href="javascript:void(0)" id="mailBtn"
            ><i class="fas fa-envelope"></i
          ></a>
          <a href="javascript:void(0)" id="userBtn" class="profile-icon">
            <img
              src="https://courier.riocargoexpress.com/assets/images/users/user.png"
              alt="profileLogo"
              style="cursor: pointer"
            />
          </a>
        </div>
      </nav>
    </header>

    <!-- Dropdown cards -->
    <div class="dropdown-card" id="alertCard">
      <h6>Alertas</h6>
      <hr />
      <p>Mensaje de alerta de ejemplo.</p>
    </div>

    <div class="dropdown-card" id="bellCard">
      <h6>Notificaciones</h6>
      <hr />
      <p>Tu paquete está en camino 🚚</p>
      <p>Nuevo mensaje recibido 📩</p>
    </div>

    <div class="dropdown-card" id="mailCard">
      <h6>Tienes 0 paquetes en retención</h6>
      <hr />
      <p>No hay paquetes retenidos.</p>
    </div>

    <div class="dropdown-card" id="userCard">
      <h6>Casillero</h6>
      <p><strong>216258</strong></p>
      <p>María Teresa Silva Pinoargote</p>
      <p>tetesilva0908@gmail.com</p>
      <hr />
      <div
        style="
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-top: 5px;
        "
      >
        <a href="#"><i class="fas fa-user"></i> Mi Perfil</a>
        <a href="#"><i class="fas fa-sign-out-alt"></i> Logout</a>
      </div>
    </div>

    <!-- Heading -->
    <h2 class="text-center text-white mt-5 font-weight-bold pb-3">
      Directorio de Tiendas
    </h2>

    <div class="container-fluid mt-3">
      <!-- Filter Section -->
      <div class="filter-section">
        <!-- Search and Filter Controls Row -->
        <div class="filter-controls-row">
          <div class="search-box">
            <input
              type="text"
              class="form-control form-control-custom"
              id="searchInput"
              placeholder="Buscar tienda..."
            />
          </div>
          <div class="filter-buttons">
            <button class="btn btn-warning" id="filtrarBtn">
              <i class="fas fa-filter"></i> Filtrar
            </button>
            <button class="btn btn-outline-light" id="limpiarBtn">
              <i class="fas fa-broom"></i> Limpiar
            </button>
          </div>
        </div>

        <!-- Modern Category Checkboxes -->
        <div class="category-filters">
          <h6>Filtrar por categoría:</h6>
          <div class="checkbox-grid">
            <div class="checkbox-item">
              <input
                type="checkbox"
                id="multicategoria"
                value="Multicategoría"
              />
              <label for="multicategoria">Multicategoría</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="tecnologia" value="Tecnología" />
              <label for="tecnologia">Tecnología</label>
            </div>
            <div class="checkbox-item">
              <input
                type="checkbox"
                id="automotriz"
                value="Automotriz & Repuestos"
              />
              <label for="automotriz">Automotriz</label>
            </div>
            <div class="checkbox-item">
              <input
                type="checkbox"
                id="belleza"
                value="Belleza & Perfumería"
              />
              <label for="belleza">Belleza & Perfumería</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="deportes" value="Deportes & Outdoor" />
              <label for="deportes">Deportes & Outdoor</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="hogar" value="Hogar & Cocina" />
              <label for="hogar">Hogar & Cocina</label>
            </div>
            <div class="checkbox-item">
              <input
                type="checkbox"
                id="juguetes"
                value="Juguetes & Hobbies / Gaming"
              />
              <label for="juguetes"> Hobbies & Gaming</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="moda" value="Moda" />
              <label for="moda">Moda</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="muebles" value="Muebles & Deco" />
              <label for="muebles">Muebles & Deco</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="salud" value="Salud & Bienestar" />
              <label for="salud">Salud & Bienestar</label>
            </div>
          </div>
        </div>
      </div>

      <!-- Cards Section -->
      <div class="table-container mb-5">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <div>
            <label for="entriesSelect" class="mr-2">Show</label>
            <select class="form-control entries-select" id="entriesSelect">
              <option value="10">10</option>
              <option value="20" selected>20</option>
              <option value="50">50</option>
              <option value="all">All</option>
            </select>
            <span>entries</span>
          </div>
        </div>

        <div class="store-cards-container" id="storeCardsContainer">
          <!-- Loading state -->
          <div class="loading-container">
            <div class="spinner"></div>
            <p>Cargando tiendas...</p>
          </div>
        </div>

        <div class="d-flex justify-content-between align-items-center mt-3">
          <div class="pagination-info" id="paginationInfo">
            Cargando datos...
          </div>
          <nav>
            <ul class="pagination pagination-custom" id="pagination">
              <!-- Pagination will be generated by JavaScript -->
            </ul>
          </nav>
        </div>
      </div>
    </div>

    <!-- Store Details Modal -->
    <div
      class="modal fade"
      id="storeModal"
      tabindex="-1"
      role="dialog"
      aria-labelledby="storeModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content modal-content-custom">
          <div class="modal-header modal-header-custom">
            <h5 class="modal-title" id="storeModalLabel">
              Detalles de la Tienda
            </h5>
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true" style="color: white">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <div id="storeDetailsContent">
              <!-- Store details will be populated by JavaScript -->
            </div>
          </div>
          <div class="modal-footer modal-footer-custom">
            <button type="button" class="btn btn-primary" data-dismiss="modal">
              Cerrar
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // State management
        let storeData = [];
        let currentPage = 1;
        let entriesPerPage = 20;
        let filteredData = [];

        // Nav dropdown functionality
        const cards = {
          alertBtn: "alertCard",
          bellBtn: "bellCard",
          mailBtn: "mailCard",
          userBtn: "userCard",
        };

        function showAlert(message) {
          const alertContainer = document.getElementById("alertContainer");
          const alertMessage = document.getElementById("alertMessage");

          alertMessage.textContent = message;
          alertContainer.style.display = "block";
          void alertContainer.offsetWidth;
          alertContainer.classList.add("show");

          setTimeout(() => {
            alertContainer.classList.remove("show");
            setTimeout(() => {
              alertContainer.style.display = "none";
            }, 500);
          }, 3000);
        }

        function toggleCard(cardId) {
          document.querySelectorAll(".dropdown-card").forEach((card) => {
            if (card.id !== cardId) card.style.display = "none";
          });
          const card = document.getElementById(cardId);
          card.style.display =
            card.style.display === "block" ? "none" : "block";
        }

        Object.keys(cards).forEach((btnId) => {
          document.getElementById(btnId).addEventListener("click", (e) => {
            e.stopPropagation();
            toggleCard(cards[btnId]);
          });
        });

        document.addEventListener("click", function (e) {
          document.querySelectorAll(".dropdown-card").forEach((card) => {
            card.style.display = "none";
          });
        });

        document.querySelectorAll(".dropdown-card").forEach((card) => {
          card.addEventListener("click", (e) => e.stopPropagation());
        });

        // Load JSON data
        function loadStoreData() {
          fetch("stores.json")
            .then((response) => {
              if (!response.ok) {
                throw new Error("Network response was not ok");
              }
              return response.json();
            })
            .then((data) => {
              storeData = data;
              filteredData = [...storeData];
              renderStoreCards();
              showAlert(`Cargadas ${storeData.length} tiendas`);
            })
            .catch((error) => {
              console.error("Error loading store data:", error);
              document.getElementById("storeCardsContainer").innerHTML =
                '<div class="col-12 text-center text-danger">Error cargando los datos de las tiendas</div>';
              showAlert("Error cargando los datos");
            });
        }

        // Store cards functionality
        function renderStoreCards() {
          const container = document.getElementById("storeCardsContainer");
          const startIndex = (currentPage - 1) * entriesPerPage;
          const endIndex = Math.min(
            startIndex + entriesPerPage,
            filteredData.length
          );
          const pageData =
            entriesPerPage === "all"
              ? filteredData
              : filteredData.slice(startIndex, endIndex);

          container.innerHTML = "";

          if (pageData.length === 0) {
            container.innerHTML =
              '<div class="col-12 text-center">No se encontraron tiendas</div>';
          } else {
            pageData.forEach((store) => {
              const card = document.createElement("div");
              card.className = "store-card";
              card.innerHTML = `
                            <img src="${store.image}" alt="${store.name}" class="store-image">
                            <div class="store-content">
                                <div class="store-name">${store.name}</div>
                                <span class="store-category">${store.category}</span>
                                <button class="store-button view-details-btn" data-id="${store.id}">Ver resumen</button>
                            </div>
                        `;
              container.appendChild(card);
            });
          }

          // Add event listeners for view details buttons
          document.querySelectorAll(".view-details-btn").forEach((btn) => {
            btn.addEventListener("click", function (e) {
              e.preventDefault();
              const storeId = parseInt(this.getAttribute("data-id"));
              openStoreModal(storeId);
            });
          });

          updatePaginationInfo();
          renderPagination();
        }

        function openStoreModal(storeId) {
          const store = storeData.find((s) => s.id === storeId);
          if (!store) return;

          const modalContent = document.getElementById("storeDetailsContent");

          // Generate table columns based on recommended_locker field
          const tableColumns = generateCasilleroTable(store);

          modalContent.innerHTML = `
            <div class="store-detail-row">
              <div class="store-detail-label">Nombre de la marca</div>
              <div class="store-detail-value">${store.brand_name}</div>
            </div>
            <div class="store-detail-row">
              <div class="store-detail-label">URL</div>
              <div class="store-detail-value">
                <a href="${store.url}" target="_blank" class="store-detail-url">${store.url}</a>
              </div>
            </div>
            <div class="store-detail-row">
              <div class="store-detail-label">Categoría principal</div>
              <div class="store-detail-value">${store.main_category}</div>
            </div>
            
            <!-- Dynamic Casillero Table Section -->
            <div class="store-detail-row">
              <div class="store-detail-label">Casilleros Recomendados</div>
              ${tableColumns}
            </div>
            
            <div class="store-detail-row">
              <div class="store-detail-label">Confianza del casillero</div>
              <div class="store-detail-value">${store.locker_confidence}</div>
            </div>
            <div class="store-detail-row">
              <div class="store-detail-label">URL del sitio en EE.UU.</div>
              <div class="store-detail-value">
                <a href="${store.us_site_url}" target="_blank" class="store-detail-url">${store.us_site_url}</a>
              </div>
            </div>
          `;

          // Add copy functionality to all copy buttons in the casillero table
          modalContent
            .querySelectorAll(".casillero-copy-btn")
            .forEach((button) => {
              button.addEventListener("click", function (e) {
                e.stopPropagation();
                const textToCopy = this.getAttribute("data-text");
                if (textToCopy && textToCopy.trim() !== "") {
                  copyToClipboard(textToCopy);
                } else {
                  showAlert("No hay texto para copiar");
                }
              });
            });

          $("#storeModal").modal("show");
        }

        // Generate casillero table based on recommended_locker field
        function generateCasilleroTable(store) {
          const recommendedLockers = store.recommended_locker
            .split(",")
            .map((l) => l.trim());

          if (recommendedLockers.length === 0) {
            return '<div class="text-center text-muted py-3">No hay datos de casilleros disponibles</div>';
          }

          // Generate table headers
          let tableHTML = `
            <div class="casillero-table-container">
              <table class="casillero-table">
                <thead>
                  <tr>
          `;

          // Add table headers for each recommended locker
          recommendedLockers.forEach((locker) => {
            tableHTML += `<th>${locker}</th>`;
          });

          tableHTML += `
                  </tr>
                </thead>
                <tbody>
                  <tr>
          `;

          // Add country sections
          recommendedLockers.forEach((locker) => {
            tableHTML += `
              <td>
                <div class="casillero-country-section">
                  <div class="casillero-country-flag">${getCountryFlag(
                    locker
                  )}</div>
                  <div class="casillero-country-name">${getCountryName(
                    locker
                  )}</div>
                </div>
                ${generateCountryLockerDetails(locker)}
              </td>
            `;
          });

          tableHTML += `
                  </tr>
                </tbody>
              </table>
            </div>
          `;

          return tableHTML;
        }

        // Helper function to get country flag
        function getCountryFlag(countryCode) {
          const flags = {
            CN: "🇨🇳",
            ES: "🇪🇸",
            US: "🇺🇸",
          };
          return flags[countryCode] || "🏳️";
        }

        // Helper function to get country name
        function getCountryName(countryCode) {
          const names = {
            CN: "China",
            ES: "España",
            US: "USA",
          };
          return names[countryCode] || countryCode;
        }

        // Generate locker details for a specific country
        function generateCountryLockerDetails(countryCode) {
          const lockerData = getLockerData(countryCode);
          const fields = [
            { key: "nombre", label: "Nombre" },
            { key: "direccion", label: "Dirección" },
            { key: "ciudad", label: "Ciudad" },
            { key: "estado", label: "Estado" },
            { key: "codigo_postal", label: "Código Postal" },
            { key: "telefono", label: "Telf" },
            { key: "apartamento", label: "Apartamento/Piso/Unidad" },
            { key: "pais", label: "País" },
          ];

          let detailsHTML = "";

          fields.forEach((field) => {
            if (lockerData[field.key]) {
              detailsHTML += `
                <div class="casillero-detail-item">
                  <span class="casillero-detail-label">${field.label}</span>
                  <div class="casillero-detail-value">
                    <span class="casillero-detail-text">${
                      lockerData[field.key]
                    }</span>
                    <button class="casillero-copy-btn" data-text="${
                      lockerData[field.key]
                    }">
                      <i class="fas fa-copy"></i>
                    </button>
                  </div>
                </div>
              `;
            }
          });

          return (
            detailsHTML ||
            '<div class="text-center text-muted py-2">No hay datos disponibles</div>'
          );
        }

        // Hardcoded locker data for each country
        function getLockerData(countryCode) {
          const lockerData = {
            CN: {
              nombre:
                "Macro Logistics – RIOCARGO María Teresa Silva Pinoargote",
              direccion: "Jinxiu Garden, Xixiang Street, Bao'an District",
              ciudad: "Shenzhen",
              estado: "Guangdong",
              codigo_postal: "518100",
              telefono: "+86 13430587809",
              apartamento: "118-120, 1st floor, Building 3",
              pais: "China",
            },
            ES: {
              nombre: "María Teresa Silva Pinoargote",
              direccion: "Calle de Albasanz 52, Local B Izq 216258",
              ciudad: "Madrid",
              estado: "Madrid",
              codigo_postal: "28037",
              telefono: "+34 646552799",
              apartamento: "RIOCARGO 216258",
              pais: "España",
            },
            US: {
              nombre: "216258 - María Teresa Silva Pinoargote",
              direccion: "12992 NW 42 Ave Ste 126",
              ciudad: "OPA LOCKA",
              estado: "FLORIDA",
              codigo_postal: "33054-4403",
              telefono: "+1 305 9678269",
              pais: "USA",
            },
          };

          return lockerData[countryCode] || {};
        }

        // Copy to clipboard function
        function copyToClipboard(text) {
          navigator.clipboard
            .writeText(text)
            .then(() => {
              showAlert("Texto copiado: " + text);
            })
            .catch((err) => {
              console.error("Error al copiar: ", err);
              showAlert("Error al copiar el texto");
            });
        }

        function updatePaginationInfo() {
          const totalEntries = filteredData.length;
          const startIndex = (currentPage - 1) * entriesPerPage + 1;
          const endIndex = Math.min(currentPage * entriesPerPage, totalEntries);
          const infoText =
            entriesPerPage === "all"
              ? `Mostrando todos los ${totalEntries} registros`
              : `Mostrando ${
                  totalEntries === 0 ? 0 : startIndex
                } a ${endIndex} de ${totalEntries} registros`;

          document.getElementById("paginationInfo").textContent = infoText;
        }

        function renderPagination() {
          if (
            entriesPerPage === "all" ||
            filteredData.length <= entriesPerPage
          ) {
            document.getElementById("pagination").innerHTML = "";
            return;
          }

          const totalPages = Math.ceil(filteredData.length / entriesPerPage);
          const pagination = document.getElementById("pagination");
          pagination.innerHTML = "";

          // Previous button
          const prevLi = document.createElement("li");
          prevLi.className = `page-item ${currentPage === 1 ? "disabled" : ""}`;
          prevLi.innerHTML = `<a class="page-link" href="#">Anterior</a>`;
          prevLi.addEventListener("click", (e) => {
            e.preventDefault();
            if (currentPage > 1) {
              currentPage--;
              renderStoreCards();
            }
          });
          pagination.appendChild(prevLi);

          // Page numbers - show limited pages with ellipsis
          const maxVisiblePages = 5;
          let startPage = Math.max(
            1,
            currentPage - Math.floor(maxVisiblePages / 2)
          );
          let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);

          if (endPage - startPage + 1 < maxVisiblePages) {
            startPage = Math.max(1, endPage - maxVisiblePages + 1);
          }

          // First page and ellipsis
          if (startPage > 1) {
            const firstLi = document.createElement("li");
            firstLi.className = "page-item";
            firstLi.innerHTML = `<a class="page-link" href="#">1</a>`;
            firstLi.addEventListener("click", (e) => {
              e.preventDefault();
              currentPage = 1;
              renderStoreCards();
            });
            pagination.appendChild(firstLi);

            if (startPage > 2) {
              const ellipsisLi = document.createElement("li");
              ellipsisLi.className = "page-item disabled";
              ellipsisLi.innerHTML = `<span class="page-link">...</span>`;
              pagination.appendChild(ellipsisLi);
            }
          }

          // Page numbers
          for (let i = startPage; i <= endPage; i++) {
            const pageLi = document.createElement("li");
            pageLi.className = `page-item ${i === currentPage ? "active" : ""}`;
            pageLi.innerHTML = `<a class="page-link" href="#">${i}</a>`;
            pageLi.addEventListener("click", (e) => {
              e.preventDefault();
              currentPage = i;
              renderStoreCards();
            });
            pagination.appendChild(pageLi);
          }

          // Last page and ellipsis
          if (endPage < totalPages) {
            if (endPage < totalPages - 1) {
              const ellipsisLi = document.createElement("li");
              ellipsisLi.className = "page-item disabled";
              ellipsisLi.innerHTML = `<span class="page-link">...</span>`;
              pagination.appendChild(ellipsisLi);
            }

            const lastLi = document.createElement("li");
            lastLi.className = "page-item";
            lastLi.innerHTML = `<a class="page-link" href="#">${totalPages}</a>`;
            lastLi.addEventListener("click", (e) => {
              e.preventDefault();
              currentPage = totalPages;
              renderStoreCards();
            });
            pagination.appendChild(lastLi);
          }

          // Next button
          const nextLi = document.createElement("li");
          nextLi.className = `page-item ${
            currentPage === totalPages ? "disabled" : ""
          }`;
          nextLi.innerHTML = `<a class="page-link" href="#">Siguiente</a>`;
          nextLi.addEventListener("click", (e) => {
            e.preventDefault();
            if (currentPage < totalPages) {
              currentPage++;
              renderStoreCards();
            }
          });
          pagination.appendChild(nextLi);
        }

        function filterData() {
          const searchTerm = document
            .getElementById("searchInput")
            .value.toLowerCase();

          // Get selected categories
          const selectedCategories = [];
          document
            .querySelectorAll(".checkbox-item input:checked")
            .forEach((checkbox) => {
              selectedCategories.push(checkbox.value);
            });

          // If no categories are selected, show all stores
          if (selectedCategories.length === 0) {
            filteredData = storeData.filter((store) => {
              return store.name.toLowerCase().includes(searchTerm);
            });
          } else {
            filteredData = storeData.filter((store) => {
              const nameMatch = store.name.toLowerCase().includes(searchTerm);
              const categoryMatch = selectedCategories.includes(store.category);

              return nameMatch && categoryMatch;
            });
          }

          currentPage = 1;
          renderStoreCards();
        }

        function clearFilters() {
          document.getElementById("searchInput").value = "";

          // Uncheck all category checkboxes
          document
            .querySelectorAll(".checkbox-item input")
            .forEach((checkbox) => {
              checkbox.checked = false;
            });

          filterData();
          showAlert("Filtros limpiados");
        }

        // Event listeners
        document
          .getElementById("filtrarBtn")
          .addEventListener("click", filterData);
        document
          .getElementById("limpiarBtn")
          .addEventListener("click", clearFilters);

        // Search as you type
        document
          .getElementById("searchInput")
          .addEventListener("input", filterData);

        // Checkbox change events
        document
          .querySelectorAll(".checkbox-item input")
          .forEach((checkbox) => {
            checkbox.addEventListener("change", filterData);
          });

        document
          .getElementById("entriesSelect")
          .addEventListener("change", function () {
            entriesPerPage =
              this.value === "all" ? "all" : parseInt(this.value);
            currentPage = 1;
            renderStoreCards();
          });

        // Initialize by loading JSON data
        loadStoreData();

        // Make functions available globally
        window.showAlert = showAlert;
        window.openStoreModal = openStoreModal;
      });
    </script>
  </body>
</html>
